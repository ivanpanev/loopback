---
- name: Schedule Firewall Upgrade Job
  hosts: localhost
  vars:
    requested_time: "{{ customer_date }} {{ customer_time }}"
  tasks:
    - name: Convert time to UTC for AWX schedule
      set_fact:
        awx_datetime: "{{ requested_time | to_datetime('%Y-%m-%d %H:%M') | to_utc | strftime('%Y%m%dT%H%M%SZ') }}"

    - name: Create schedule for Job 2
      awx.awx.tower_schedule:
        name: "Upgrade at {{ requested_time }}"
        job_template: "Your_Job2_Template_ID"
        rrule: "DTSTART:{{ awx_datetime }};FREQ=ONCE"
        extra_vars:
          target_version: "{{ target_version }}"
          gn_ids: "{{ gn_ids | join(',') }}"
        tower_host: "https://your-awx-host"
        tower_username: "awx_user"
        tower_password: "awx_password"
        validate_certs: false
