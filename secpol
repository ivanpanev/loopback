curl -k "https://100.66.31.9/api/?type=keygen&user=t3-admin&password=<PASS>"





- name: Palo API health-probe (keygen)
  uri:
    url: "https://{{ nb_primary_ip }}/api/"
    validate_certs: no
    return_content: yes
    status_code: 200
    method: GET
    params:
      type: keygen
      user: "{{ api_user }}"
      password: "{{ api_pass }}"
  delegate_to: "{{ nb_jumphost }}"
  register: probe
  failed_when: "'<response status=\"success\"' not in probe.content"










########################################################################
# Connectivity check – fail early if the jumphost cannot open TCP/443  #
########################################################################
- name: Verify API port reachable from {{ nb_jumphost }}
  wait_for:
    host: "{{ nb_primary_ip }}"
    port: 443
    timeout: 5          # 🔁 adjust if the link is high-latency
    state: started
  delegate_to: "{{ nb_jumphost }}"








